# ANSSI λ…Όλ¬Έ ν•µμ‹¬ μ”μ•½ λ° μ‹¤ν— μ„¤κ³„

## π” ANSSI λ…Όλ¬Έμ ν•µμ‹¬ λ°κ²¬

### "Counter-Intuitive" κ²°κ³Ό

> "Even when the SecureChannel is negotiated with SignAndEncrypt,
> the UserNameIdentityToken.Password field may still appear in plaintext
> when a downgrade or renegotiation occurs."

**μ§κ΄€**: "μ•”νΈν™”λμ–΄ μμΌλ©΄ μ•μ „ν•λ‹¤"
**ν„μ‹¤**: "λ…μ„Έμƒ κµ¬μ΅°μ μΌλ΅ ν‰λ¬Έ λ…Έμ¶ κ°€λ¥"

## π“ λ…μ„Έ λ¶„μ„ κ²°κ³Ό

### OPC UA κµ¬μ΅°μ  λ¬Έμ 

1. **SecureChannel κ³„μΈµ** (μ•”νΈν™” λ‹΄λ‹Ή)
   - ν•μ„ κ³„μΈµλ§ λ³΄νΈ (μ „μ†΅ λ³΄νΈ)
   - μƒμ„ κ³„μΈµμ€ λ³„λ„ λ³΄νΈ μ—†μ

2. **Session κ³„μΈµ** (μΈμ¦ λ‹΄λ‹Ή)
   - UserIdentityToken μ „μ†΅
   - μ•”νΈν™” λ³΄νΈ μμ΅΄ (SecureChannelμ— μμ΅΄)

3. **μ¬ν‘μƒ λ¬Έμ **
   - μ±„λ„ μ¬ν‘μƒ μ‹ μ„Έμ… μ μ§€ κ°€λ¥
   - SecurityPolicy λ³€κ²½ κ°€λ¥ (μ•”νΈν™” β†’ ν‰λ¬Έ)

## β™οΈ μ¬λ°”λ¥Έ μ‹¤ν— μμ„

### ν•„μ” μ΅°κ±΄

1. **μ΄κΈ° μ„¤μ •**: SignAndEncrypt (μ•”νΈν™” μ±„λ„)
2. **μ±„λ„ μ¬ν‘μƒ**: Renew μ”μ²­
3. **λ‹¤μ΄κ·Έλ μ΄λ“**: SecurityPolicy β†’ None
4. **ν‰λ¬Έ λ…Έμ¶**: ActivateSessionμ—μ„ ν™•μΈ

### ν„μ¬ μ‹¤ν—μ λ¬Έμ μ 

β ν„μ¬: NoSecurityλ΅ μ‹μ‘
- μ•”νΈν™” λ‹¨κ³„λ¥Ό μƒλµ
- "μ•”νΈν™”λμ–΄λ„ ν‰λ¬Έ λ…Έμ¶" μ¦λ… λ¶κ°€

β… ν•„μ”: SignAndEncrypt β†’ λ‹¤μ΄κ·Έλ μ΄λ“ β†’ None
- "μ•”νΈν™”λμ–΄ μλ”λ°λ„ ν‰λ¬Έ λ…Έμ¶" μ¦λ… κ°€λ¥

## π― ANSSI μ—°κµ¬ μ¬ν„μ„ μ„ν• λ‹¨κ³„

### 1λ‹¨κ³„: μ•”νΈν™” μ±„λ„ μ„¤μ •
```
μ„λ²„: Basic256Sha256_SignAndEncrypt
ν΄λΌμ΄μ–ΈνΈ: SignAndEncrypt λ¨λ“λ΅ μ—°κ²°
```

### 2λ‹¨κ³„: μ±„λ„ μ¬ν‘μƒ
```
κ³µκ²©μ: OpenSecureChannel (RequestType=Renew)
        SecurityPolicyUri = None λ³€κ²½
```

### 3λ‹¨κ³„: ν‰λ¬Έ λ…Έμ¶ ν™•μΈ
```
ActivateSession: UserNameIdentityToken.Password
β†’ ν‰λ¬ΈμΌλ΅ μ „μ†΅λ¨ ν™•μΈ
```

### 4λ‹¨κ³„: λΉ„κµ λ¶„μ„
```
μ •μƒ: Basic256Sha256 β†’ μ•”νΈν™”λ blob
κ³µκ²©: None β†’ ν‰λ¬Έ λ…Έμ¶
```

## π’΅ μ‹¤ν— μ„¤κ³„ ν¬μΈνΈ

### ANSSIκ°€ λ³΄μ—¬μ¤€ κ²ƒ

| λ‹¨κ³„ | κ°λ°μ μ§κ΄€ | λ…μ„Έ μ‹¤μ  λ™μ‘ | κ²°κ³Ό |
|------|------------|--------------|------|
| μ΄κΈ° | "μ•”νΈν™”λλ©΄ μ•μ „" | SignAndEncrypt μ μ© | β… μ•μ „ |
| μ¬ν‘μƒ | "μ„Έμ… μ¬μ„¤μ • ν•„μ" | μ„Έμ… μ μ§€ κ°€λ¥ | β οΈ μ·¨μ•½ |
| λ‹¤μ΄κ·Έλ μ΄λ“ | "μ•”νΈν™” μ μ§€" | NoneμΌλ΅ λ³€κ²½ κ°€λ¥ | β μ„ν— |
| μκ²©μ¦λ… | "μ•”νΈν™”λ¨" | ν‰λ¬ΈμΌλ΅ μ „μ†΅ | β λ„μ¶ |

### ν•µμ‹¬ λ©”μ‹μ§€

**"κµ¬μ΅°μ  μ·¨μ•½μ μ΄ μ•„λ‹ λ…μ„Έμƒ ν—μ©λ λ™μ‘"**

- λ²„κ·Έκ°€ μ•„λ‹
- λ…μ„Έκ°€ ν—μ©ν•λ” λ™μ‘
- κ°λ°μ μ§κ΄€κ³Ό λ‹¤λ¦„

## π€ μ‹¤ν— μ¬μ„¤κ³„ ν•„μ”

### ν„μ¬ μƒνƒ
```
NoSecurity β†’ ν‰λ¬Έ μ „μ†΅
(μ•”νΈν™” μ—†μ΄ ν‰λ¬Έ)
```

### ν•„μ” μƒνƒ (ANSSI μ¬ν„)
```
SignAndEncrypt β†’ λ‹¤μ΄κ·Έλ μ΄λ“ β†’ None
(μ•”νΈν™” β†’ ν‰λ¬ΈμΌλ΅ λ³€κ²½)
```

## π“ λ…Όλ¬Έμ© μ„¤λ… λ¬Έκµ¬

**ANSSI μ—°κµ¬ μ¬ν„**:
"μ΄κΈ° SecureChannelμ„ SignAndEncryptλ΅ ν‘μƒν• ν›„, μ±„λ„ μ¬ν‘μƒ μ‹ SecurityPolicyλ¥Ό NoneμΌλ΅ κ°•μ  λ‹¤μ΄κ·Έλ μ΄λ“ν• κ²°κ³Ό, ActivateSessionμ UserNameIdentityToken.Password ν•„λ“κ°€ ν‰λ¬ΈμΌλ΅ μ „μ†΅λλ” κ²ƒμ„ ν™•μΈν•μ€λ‹¤."

**ν„μ¬ μ‹¤ν— ν•κ³„**:
"ν„μ¬ μ‹¤ν— ν™κ²½μ€ NoSecurity μ„¤μ •μΌλ΅ μ‹μ‘ν•μ—¬ ν‰λ¬Έ μ „μ†΅μ„ ν™•μΈν–μΌλ‚, ANSSI λ…Όλ¬Έμ—μ„ μ§€μ ν• 'μ•”νΈν™” μƒνƒμ—μ„ λ‹¤μ΄κ·Έλ μ΄λ“λ΅ μΈν• ν‰λ¬Έ λ…Έμ¶' μ‹λ‚λ¦¬μ¤λ” μ•„μ§ μ¬ν„ν•μ§€ λ»ν–λ‹¤."
