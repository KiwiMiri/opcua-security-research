# OPC UA Password Downgrade 공격

## 📋 공격 개요

**Password Downgrade 공격**은 OPC UA 보안 메커니즘의 취약점을 이용하여
강력한 인증 방식을 약한 방식으로 강등(downgrade)시키는 공격입니다.

## 🎯 공격 시나리오

### 1. 정상 인증 과정

```
클라이언트                          서버
    │                                │
    │──── GetEndpoints Request ─────>│
    │                                │ 
    │<─── Endpoints (보안 정책들) ───│
    │     - SignAndEncrypt           │
    │     - Sign                     │
    │     - None                     │
    │                                │
    │──── CreateSession (Sign) ─────>│
    │                                │
    │<─── Session Created ───────────│
    │                                │
    │──── ActivateSession ──────────>│
    │     (UserName + Password)      │
    │                                │
    │<─── Activated ────────────────│
```

### 2. Downgrade 공격

```
공격자 (중간자)              클라이언트              서버
    │                          │                    │
    │                          │─── GetEndpoints ──>│
    │                          │                    │
    │<─ Endpoints 가로채기 ────│<────── Endpoints ──│
    │   (보안 정책 수정)        │                    │
    │                          │                    │
    │── Modified Endpoints ───>│                    │
    │   - None만 사용 가능      │                    │
    │                          │                    │
    │                          │─── CreateSession ─>│
    │                          │    (None 정책)     │
    │                          │                    │
    │<──── 평문 패스워드 탈취! ──────────────────────│
```

## 🔓 취약점 분석

### 취약한 버전
- **open62541 < 1.3.9** - GetEndpoints 응답 조작 가능
- **Python opcua < 0.98.14** - 보안 정책 검증 미흡
- **S2OPC < 1.4.1** - 정책 강제 메커니즘 부재

### 공격 조건
1. ✅ 중간자 공격 가능 (MITM)
2. ✅ 서버가 NoSecurity 정책 지원
3. ✅ 클라이언트가 보안 정책 자동 선택

## 🛠️ PoC 구현 단계

### Step 1: 네트워크 스니핑
```python
# GetEndpoints 요청/응답 캡처
# 보안 정책 목록 확인
```

### Step 2: MITM 프록시 구축
```python
# GetEndpoints 응답 수정
# NoSecurity만 남기고 나머지 제거
```

### Step 3: 패스워드 탈취
```python
# ActivateSession 메시지에서 평문 패스워드 추출
```

## 📁 파일 구조

```
/root/opcua-research/exploits/
├── PASSWORD_DOWNGRADE_ATTACK.md  ← 이 문서
├── password_downgrade_poc.py     ← PoC 구현 (예정)
├── mitm_proxy.py                 ← MITM 프록시 (예정)
└── packet_analyzer.py            ← 패킷 분석기 (예정)
```

## 🎓 다음 단계

1. ✅ ANSSI PoC 문서 분석
2. ⏳ 네트워크 패킷 캡처 도구 설정
3. ⏳ MITM 프록시 구현
4. ⏳ Downgrade 공격 테스트
5. ⏳ 패스워드 탈취 검증

---
작성일: $(date '+%Y-%m-%d %H:%M:%S')
상태: Step 1 진행 중
